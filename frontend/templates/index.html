<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QueryGPT - AI数据库查询</title>
    
    <!-- 外部资源 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    
    <!-- 内部样式 -->
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/about-settings.css?v=20250821">
    <link rel="stylesheet" href="/static/css/dual-view-system.css">
    <link rel="stylesheet" href="/static/css/thinking-progress-enhanced.css">
    <link rel="stylesheet" href="/static/css/responsive.css">
    <link rel="stylesheet" href="/static/css/query-summary.css">
    <link rel="stylesheet" href="/static/css/ui-fixes.css">
    <link rel="stylesheet" href="/static/css/history.css">
    <link rel="stylesheet" href="/static/css/language-toggle.css">
</head>
<body>
    <div class="container">
        <!-- 遮罩层 -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>
        
        <!-- 移动端菜单按钮 -->
        <button class="mobile-menu-btn" id="menu-toggle-btn">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- 侧边栏 -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-chart-line"></i> QueryGPT</h2>
            </div>
            
            <nav class="sidebar-nav">
                <ul class="menu-list">
                    <!-- 查询菜单 -->
                    <li class="menu-item has-submenu expanded">
                        <a href="#" class="menu-header">
                            <i class="fas fa-search"></i>
                            <span data-i18n="nav.query">查询</span>
                            <i class="fas fa-chevron-down submenu-arrow"></i>
                        </a>
                        <ul class="submenu">
                            <li>
                                <a href="#" class="nav-link active" data-tab="chat">
                                    <i class="fas fa-plus-circle"></i> <span data-i18n="nav.newQuery">数据查询</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="nav-link" data-tab="history">
                                    <i class="fas fa-history"></i> <span data-i18n="nav.history">历史记录</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                    
                    <!-- 设置菜单 -->
                    <li class="menu-item has-submenu">
                        <a href="#" class="menu-header">
                            <i class="fas fa-cog"></i>
                            <span data-i18n="nav.settings">设置</span>
                            <i class="fas fa-chevron-down submenu-arrow"></i>
                        </a>
                        <ul class="submenu" style="display: none;">
                            <li>
                                <a href="#" class="nav-link" data-tab="settings" data-settings-tab="basic">
                                    <i class="fas fa-cog"></i> <span data-i18n="nav.basicSettings">基础设置</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="nav-link" data-tab="settings" data-settings-tab="models">
                                    <i class="fas fa-brain"></i> <span data-i18n="nav.modelManagement">模型管理</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="nav-link" data-tab="settings" data-settings-tab="database">
                                    <i class="fas fa-database"></i> <span data-i18n="nav.databaseConfig">数据库配置</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                    
                    <!-- 关于菜单 -->
                    <li class="menu-item">
                        <a href="#" class="nav-link" data-tab="about">
                            <i class="fas fa-info-circle"></i>
                            <span data-i18n="nav.about">关于</span>
                        </a>
                    </li>
                </ul>
            </nav>
            
            <div class="sidebar-footer">
            </div>
        </aside>
        
        <!-- 主内容区 -->
        <main class="main-content">
            <!-- 数据查询页面 -->
            <div class="tab-content active" id="chat-tab">
                <div class="chat-header">
                    <div class="header-left">
                        <h1 data-i18n="chat.title">数据查询与分析</h1>
                    </div>
                    <div class="header-controls">
                        <div class="language-toggle">
                            <span class="lang-label">中文</span>
                            <label class="switch">
                                <input type="checkbox" id="header-lang-toggle">
                                <span class="slider round"></span>
                            </label>
                            <span class="lang-label">English</span>
                        </div>
                        <div class="model-selector">
                            <select id="current-model">
                                <option value="gpt-4.1">GPT-4.1</option>
                                <option value="claude-sonnet-4">Claude Sonnet 4</option>
                                <option value="deepseek-r1">DeepSeek R1</option>
                                <option value="qwen-flagship">Qwen 旗舰模型</option>
                            </select>
                        </div>
                        <button class="btn-new-conversation" id="new-conversation">
                            <i class="fas fa-plus"></i> <span data-i18n="chat.newConversation">新对话</span>
                        </button>
                    </div>
                </div>
                
                <div class="chat-container">
                    <div class="chat-messages" id="chat-messages">
                        <!-- 欢迎消息将由JavaScript动态生成 -->
                    </div>
                    
                    <div class="chat-input-container">
                        <div class="chat-input">
                            <textarea id="message-input" 
                                      placeholder="输入查询内容..." 
                                      data-i18n="chat.inputPlaceholder"
                                      rows="3"></textarea>
                            <button id="send-button" class="send-button">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                            <button id="stop-button" class="stop-button" style="display: none;">
                                <i class="fas fa-stop"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 导出结果页面 -->
            <div class="tab-content" id="export-tab">
                <div class="page-header">
                    <h1>导出结果</h1>
                </div>
                <div class="export-container">
                    <div class="settings-card">
                        <h3><i class="fas fa-file-export"></i> 导出选项</h3>
                        <div class="form-group">
                            <label>导出格式</label>
                            <select id="export-format">
                                <option value="excel">Excel (.xlsx)</option>
                                <option value="csv">CSV (.csv)</option>
                                <option value="json">JSON (.json)</option>
                                <option value="html">HTML报表</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>包含内容</label>
                            <label class="checkbox-label">
                                <input type="checkbox" checked> 查询结果数据
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" checked> 可视化图表
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox"> 执行的SQL语句
                            </label>
                        </div>
                        <button class="btn-primary" id="export-data">
                            <i class="fas fa-download"></i> 导出数据
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 系统设置页面 -->
            <div class="tab-content" id="settings-tab">
                <div class="page-header">
                    <h1 data-i18n="settings.title">系统设置</h1>
                </div>
                
                <div class="settings-container">
                    
                    <!-- 基础设置标签页 -->
                    <div class="settings-panel active" id="basic-settings">
                        <div class="settings-card">
                            <h3><i class="fas fa-cog"></i> <span data-i18n="settings.title">基础设置</span></h3>
                            <div class="form-group">
                                <label data-i18n="settings.language">语言</label>
                                <select id="language-select">
                                    <option value="zh">中文</option>
                                    <option value="en">English</option>
                                </select>
                                <small data-i18n="settings.languageDesc">选择系统界面语言</small>
                            </div>
                            <div class="form-group">
                                <label data-i18n="settings.viewMode">默认视图模式</label>
                                <select id="default-view-mode">
                                    <option value="user">用户模式（简洁）</option>
                                    <option value="developer">开发者模式（详细）</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label data-i18n="settings.contextRounds">上下文保留轮数</label>
                                <select id="context-rounds">
                                    <option value="0">不保留历史（单轮对话）</option>
                                    <option value="1">保留1轮历史</option>
                                    <option value="2">保留2轮历史</option>
                                    <option value="3" selected>保留3轮历史（推荐）</option>
                                    <option value="5">保留5轮历史</option>
                                    <option value="10">保留10轮历史（可能影响性能）</option>
                                </select>
                                <small data-i18n="settings.contextDesc">设置AI记住之前几轮对话的内容，用于错误修正和上下文理解</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 模型管理标签页 -->
                    <div class="settings-panel" id="models-settings">
                        <div class="settings-card">
                            <div class="card-header">
                                <h3><i class="fas fa-brain"></i> <span data-i18n="models.title">模型管理</span></h3>
                            </div>
                            
                            <!-- 模型列表表格 -->
                            <div class="table-container">
                                <table class="models-table">
                                    <thead>
                                        <tr>
                                            <th data-i18n="models.name">模型名称</th>
                                            <th data-i18n="models.type">类型</th>
                                            <th data-i18n="models.apiAddress">API地址</th>
                                            <th data-i18n="models.status">状态</th>
                                            <th data-i18n="models.actions">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="models-list">
                                        <tr>
                                            <td>GPT-4.1</td>
                                            <td>OpenAI</td>
                                            <td>http://localhost:11434/v1</td>
                                            <td><span class="status-badge active">可用</span></td>
                                            <td>
                                                <button class="btn-icon" title="编辑" onclick="app.editModel('gpt-4.1')">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="btn-icon" title="测试" onclick="app.testModel('gpt-4.1')">
                                                    <i class="fas fa-plug"></i>
                                                </button>
                                                <button class="btn-icon danger" title="删除" onclick="app.deleteModel('gpt-4.1')">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Claude Sonnet 4</td>
                                            <td>Anthropic</td>
                                            <td>http://localhost:11434/v1</td>
                                            <td><span class="status-badge active">可用</span></td>
                                            <td>
                                                <button class="btn-icon" title="编辑" onclick="app.editModel('claude-sonnet-4')">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="btn-icon" title="测试" onclick="app.testModel('claude-sonnet-4')">
                                                    <i class="fas fa-plug"></i>
                                                </button>
                                                <button class="btn-icon danger" title="删除" onclick="app.deleteModel('claude-sonnet-4')">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 数据库配置标签页 -->
                    <div class="settings-panel" id="database-settings">
                        <div class="settings-card">
                            <h3><i class="fas fa-database"></i> <span data-i18n="database.title">Doris数据库配置</span></h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label data-i18n="database.host">主机地址</label>
                                    <input type="text" id="db-host" placeholder="例如: localhost 或 192.168.1.100" data-i18n="database.hostPlaceholder">
                                </div>
                                <div class="form-group">
                                    <label data-i18n="database.port">端口</label>
                                    <input type="number" id="db-port" placeholder="3306" value="3306">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label data-i18n="database.username">用户名</label>
                                    <input type="text" id="db-user" placeholder="数据库用户名" data-i18n="database.usernamePlaceholder">
                                </div>
                                <div class="form-group">
                                    <label data-i18n="database.password">密码</label>
                                    <input type="password" id="db-password" placeholder="数据库密码" data-i18n="database.passwordPlaceholder">
                                </div>
                            </div>
                            <div class="form-group">
                                <label data-i18n="database.dbName">数据库名</label>
                                <input type="text" id="db-name" placeholder="留空使用所有数据库" data-i18n="database.dbNamePlaceholder">
                                <small data-i18n="database.hint">提示：留空可访问所有可用数据库</small>
                            </div>
                            <div class="button-group">
                                <button class="btn-primary" id="test-db">
                                    <i class="fas fa-plug"></i> <span data-i18n="database.testConnection">测试连接</span>
                                </button>
                                <button class="btn-secondary" id="save-db-config">
                                    <i class="fas fa-save"></i> <span data-i18n="database.saveConfig">保存配置</span>
                                </button>
                            </div>
                            
                            <!-- 连接状态显示 -->
                            <div class="connection-status-box" id="db-connection-status" style="display: none;">
                                <div class="status-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="status-info">
                                    <h4 data-i18n="database.connectionSuccess">连接成功</h4>
                                    <p><span data-i18n="database.connectionInfo">数据库连接正常，共发现</span> <span id="table-count">0</span> <span>个表</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
            
            <!-- 关于页面 -->
            <div class="tab-content" id="about-tab">
                <div class="about-header">
                    <h1 data-i18n="about.title">关于系统</h1>
                </div>
                
                <div class="about-hero">
                    <div class="hero-content">
                        <div class="logo-section">
                            <img src="/static/images/logo.png" alt="QueryGPT Logo" style="width: 320px; height: auto; margin: 0 auto; display: block;">
                        </div>
                        <div class="hero-info">
                            <p class="system-version" style="color: #6c757d;"><span data-i18n="about.version">版本</span> v1.0.0 Beta | 2025年8月</p>
                            <div class="hero-badges">
                                <span class="badge-item">
                                    <i class="fas fa-robot"></i> <span data-i18n="about.features.ai">智能数据分析</span>
                                </span>
                                <span class="badge-item">
                                    <i class="fas fa-database"></i> <span data-i18n="about.features.database">数据库查询</span>
                                </span>
                                <span class="badge-item">
                                    <i class="fas fa-chart-pie"></i> <span data-i18n="about.features.visualization">可视化生成</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="about-cards">
                    <div class="about-card">
                        <div class="card-icon">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="card-content">
                            <h3 data-i18n="about.developer">开发者</h3>
                            <p class="card-main">MKY</p>
                            <p class="card-sub" data-i18n="about.independentDev">独立开发者</p>
                        </div>
                    </div>
                    
                    <div class="about-card">
                        <div class="card-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <div class="card-content">
                            <h3 data-i18n="about.organization">所属单位</h3>
                            <p class="card-main" data-i18n="about.openSource">开源项目</p>
                            <p class="card-sub">MIT License</p>
                        </div>
                    </div>
                    
                    <div class="about-card">
                        <div class="card-icon">
                            <i class="fas fa-code-branch"></i>
                        </div>
                        <div class="card-content">
                            <h3 data-i18n="about.versionInfo">版本信息</h3>
                            <p class="card-main">v1.0.0 Beta</p>
                            <p class="card-sub" data-i18n="about.betaVersion">测试版本</p>
                        </div>
                    </div>
                    
                    <div class="about-card">
                        <div class="card-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="card-content">
                            <h3 data-i18n="about.updateTime">更新时间</h3>
                            <p class="card-main">2025年8月</p>
                            <p class="card-sub" data-i18n="about.maintaining">持续维护中</p>
                        </div>
                    </div>
                </div>
                
                <div class="license-section">
                    <h2><i class="fas fa-file-contract"></i> <span data-i18n="about.license">许可证说明</span></h2>
                    <div class="license-content">
                        <div class="license-item">
                            <strong>OpenInterpreter 核心引擎：</strong> MIT许可证 
                            <span class="license-info">
                                <i class="fas fa-info-circle"></i> 
                                开源自然语言代码执行引擎，允许商业使用
                            </span>
                            <div class="license-details">
                                <small>• 本项目使用pip安装的0.4.3版本，遵循MIT许可证</small>
                                <small>• 允许自由使用、修改和部署</small>
                                <small>• 提供自然语言转代码的核心AI能力</small>
                            </div>
                        </div>
                        <div class="license-item">
                            <strong>Flask/PyMySQL/Plotly等：</strong> MIT/BSD许可证 
                            <span class="license-info">
                                <i class="fas fa-info-circle"></i> 
                                允许商业使用、修改和分发
                            </span>
                            <div class="license-details">
                                <small>• Flask 3.1.1 - 轻量级Web框架，BSD许可证</small>
                                <small>• PyMySQL 1.1.1 - MySQL数据库连接库，MIT许可证</small>
                                <small>• Plotly 6.3.0 - 数据可视化库，MIT许可证</small>
                                <small>• 所有依赖均为开源许可证</small>
                            </div>
                        </div>
                        <div class="license-item">
                            <div class="license-notice">
                                <i class="fas fa-exclamation-triangle"></i> 
                                <strong>免责声明：</strong> 本系统为大模型驱动的工具，开发者对使用过程中可能出现的数据损失或其他问题不承担责任。请在使用前做好数据备份和权限管理。
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 技术栈部分 -->
                <div class="tech-stack-section">
                    <h2><i class="fas fa-layer-group"></i> <span data-i18n="about.techStack">技术栈</span></h2>
                    <div class="tech-grid">
                        <div class="tech-group">
                            <h3><i class="fas fa-server"></i> <span data-i18n="about.backend">后端技术</span></h3>
                            <div class="tech-badges">
                                <span class="tech-badge">Python 3.10</span>
                                <span class="tech-badge">Flask 3.1.1</span>
                                <span class="tech-badge">OpenInterpreter 0.4.3</span>
                                <span class="tech-badge">PyMySQL 1.1.1</span>
                                <span class="tech-badge">Pandas 2.3.1</span>
                                <span class="tech-badge">Plotly 6.3.0</span>
                            </div>
                        </div>
                        <div class="tech-group">
                            <h3><i class="fas fa-palette"></i> <span data-i18n="about.frontend">前端技术</span></h3>
                            <div class="tech-badges">
                                <span class="tech-badge">HTML5</span>
                                <span class="tech-badge">CSS3</span>
                                <span class="tech-badge">JavaScript ES6</span>
                                <span class="tech-badge">Plotly.js</span>
                                <span class="tech-badge">Marked.js</span>
                                <span class="tech-badge">Highlight.js</span>
                            </div>
                        </div>
                        <div class="tech-group">
                            <h3><i class="fas fa-database"></i> <span data-i18n="nav.databaseConfig">数据库</span></h3>
                            <div class="tech-badges">
                                <span class="tech-badge">Apache Doris</span>
                                <span class="tech-badge">MySQL Protocol</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="system-usage">
                    <h2><i class="fas fa-info-circle"></i> <span data-i18n="about.usageStatement">本系统使用声明</span></h2>
                    <p>本系统基于开源组件开发，采用 MIT 许可证：</p>
                    <ul>
                        <li data-i18n="about.freeUse">自由使用、修改和分发</li>
                        <li data-i18n="about.commercial">支持商业和非商业用途</li>
                        <li data-i18n="about.copyright">请保留版权声明</li>
                    </ul>
                    <div class="developer-contact">
                        <p><i class="fas fa-envelope"></i> <strong data-i18n="about.contactEmail">开发者联系邮箱：</strong> mky369258@gmail.com</p>
                    </div>
                </div>
            </div>
            
            <!-- 历史记录页面 -->
            <div class="tab-content" id="history-tab">
                <div class="history-container">
                    <div class="history-header">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h2 class="history-title" style="margin: 0;">
                                <i class="fas fa-history"></i>
                                <span data-i18n="history.title">历史记录</span>
                            </h2>
                            <button id="refresh-history-btn" class="btn-icon" title="刷新历史记录" 
                                    style="background: white; border: 1px solid #dee2e6; color: #6c757d; 
                                           padding: 8px 12px; border-radius: 6px; cursor: pointer; 
                                           transition: all 0.3s ease;"
                                    onmouseover="this.style.background='#f8f9fa'; this.style.transform='rotate(180deg)'"
                                    onmouseout="this.style.background='white'; this.style.transform='rotate(0deg)'"
                                    onclick="if(window.HistoryManager.instance) { window.HistoryManager.instance.loadRecentConversations(); this.style.transform='rotate(360deg)'; }">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                        
                        <div class="history-search-container">
                            <input type="text" id="history-search" placeholder="搜索历史记录..." data-i18n="history.search">
                            <i class="fas fa-search history-search-icon"></i>
                        </div>
                        
                        <div class="history-filters">
                            <button class="history-filter-btn active" data-filter="recent">
                                <i class="fas fa-clock"></i> <span data-i18n="history.recent">最近</span>
                            </button>
                            <button class="history-filter-btn" data-filter="today">
                                <i class="fas fa-calendar-day"></i> <span data-i18n="history.today">今天</span>
                            </button>
                            <button class="history-filter-btn" data-filter="week">
                                <i class="fas fa-calendar-week"></i> <span data-i18n="history.thisWeek">本周</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="history-list-container" id="history-list-container">
                        <div id="history-loading" class="history-loading">
                            <div class="history-loading-spinner"></div>
                            <p data-i18n="history.loading">加载中...</p>
                        </div>
                        <div id="history-list"></div>
                    </div>
                    
                </div>
            </div>
            
        </main>
    </div>
    
    <!-- 全局通知 -->
    <div class="notification" id="notification">
        <div class="notification-content">
            <i class="notification-icon"></i>
            <span class="notification-text"></span>
        </div>
    </div>
    
    <!-- 加载提示 -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p data-i18n="common.loading">处理中...</p>
        </div>
    </div>
    
    <!-- 删除确认弹窗 -->
    <div class="delete-modal" id="delete-modal">
        <div class="delete-modal-content">
            <div class="delete-modal-header">
                <i class="fas fa-exclamation-triangle delete-modal-icon"></i>
                <h3 class="delete-modal-title">确认删除</h3>
            </div>
            <div class="delete-modal-body">
                <span data-i18n="history.deleteConfirm">确定要删除这个对话吗？此操作无法撤销。</span>
            </div>
            <div class="delete-modal-footer">
                <button class="delete-modal-btn delete-modal-btn-cancel" onclick="window.HistoryManager.instance.closeDeleteModal()">
                    <span data-i18n="history.cancel">取消</span>
                </button>
                <button class="delete-modal-btn delete-modal-btn-delete" id="confirm-delete-btn">
                    <i class="fas fa-trash"></i> <span data-i18n="history.delete">删除</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- JavaScript -->
    <script src="/static/js/i18n.js"></script>
    <script src="/static/js/performance.js"></script>
    <script src="/static/js/error-handler.js"></script>
    <script src="/static/js/api.js"></script>
    <script src="/static/js/settings.js"></script>
    <script src="/static/js/history-manager.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>